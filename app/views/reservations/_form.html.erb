<%= form_for([@room, @room.reservations.new]) do |f| %>
    
    <div class="row">
        <div class="col-md-12 price_tag">
            <span>$<%= @room.price %></span>
            <span class="pull-right">Per night</span>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6">
            <label>Arrival</label>
            <%= f.text_field :start_date, readonly: 'true', placeholder: 'mm/dd/yyyy', class: 'form-control' %>
        </div>

         <div class="col-md-6">
            <label>Departure</label>
            <%= f.text_field :end_date, readonly: 'true', placeholder: 'mm/dd/yyyy', class: 'form-control', disabled: 'true' %>
        </div>
    </div>

    <div id="preview" style="display: none">
        <table class="reservation-table">
            <tbody>
                <tr>
                    <td>Night(s)</td>
                    <td><span id="reservation_days"></span></td>
                </tr>
                <tr>
                    <td>Total</td>
                    <td><span id="reservation_sum"></span></td>
                </tr>
            </tbody>
        </table>
    </div>

    <%= f.hidden_field :room_id, value: @room.id %>
    <%= f.hidden_field :price, value: @room.price %>
    <%= f.hidden_field :total, id:'reservation_total' %>

    <br>
    
    <%= f.submit "Request a reservation", class: "btn btn-primary wide" %>
<% end %>

<script>

    function unavailable(date){
        mdy = (date.getMonth()+ 1) + "-" + date.getDate() + "-" + date.getFullYear();
        return[$.inArray(mdy, unavailableDates) == -1];
    }

    $(function(){

        unavailableDates = [];

        $.ajax({
            url: '/preload',
            data: {'room_id': <%= @room.id %> },
            dataType: 'json',
            success: function(data) {
                $.each(data, function(arrID, arrValue){
                    for(var d = new Date(arrValue.start_date); d <= new Date(arrValue.end_date); d.setDate(d.getDate() +1)) {
                        unavailableDates.push($.datepicker.formatDate('m-d-yy', d));
                    }
                })

                $('#reservation_start_date').datepicker({
                    dateFormat: 'mm-dd-yy',
                    minDate: 0,
                    maxDate: '3m',
                    beforeShowDay: unavailable,
                    onSelect: function(selected) {
                        $('#reservation_end_date').datepicker("option", "minDate", selected);
                        $('#reservation_end_date').attr('disabled', false);
                    }
                });

                $('#reservation_end_date').datepicker({
                    dateFormat: 'mm-dd-yy',
                    minDate: 0,
                    maxDate: '3m',
                    beforeShowDay: unavailable,
                    onSelect: function(selected) {
                        $('#reservation_start_date').datepicker("option", "maxDate", selected);
                    }
                });
        }
        });

      
    });
</script>